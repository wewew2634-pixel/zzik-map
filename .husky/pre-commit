#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# ZZIK Backend Quality Gate
echo "ğŸ” Running pre-commit checks..."

# Run lint-staged for changed files
npx lint-staged

# Run backend tests if core files changed
CHANGED_FILES=$(git diff --cached --name-only --diff-filter=ACM)

if echo "$CHANGED_FILES" | grep -qE "^apps/web/src/core/|^prisma/|^tests/backend/"; then
  echo "ğŸ§ª Backend files changed, running tests..."
  pnpm test:backend || {
    echo "âŒ Backend tests failed. Commit aborted."
    exit 1
  }
fi

echo "âœ… Pre-commit checks passed!"
